{% extends "base.html" %}

{% block content %}
<h1>B·∫£ng ƒëi·ªÅu khi·ªÉn Th·ªëng k√™</h1>

<div class="task-summary" style="margin-bottom: 20px;">
    <h2>T·ª∑ l·ªá ho√†n th√†nh c√¥ng vi·ªác</h2>
    <h3 style="color: #4CAF50;">{{ task_data.rate }}%</h3>
    <p>({{ task_data.data.0 }} ƒë√£ ho√†n th√†nh / {{ task_data.data.0|add:task_data.data.1 }} t·ªïng s·ªë)</p>
</div>

<hr>

<div style="max-width: 800px; margin-bottom: 40px;">
    <h2>Th·ªùi gian h·ªçc theo ng√†y (30 ng√†y qua)</h2>
    <canvas id="studyChart"></canvas>
</div>

<div style="display: flex; justify-content: space-around; flex-wrap: wrap;">
    
    <div style="max-width: 350px; margin-bottom: 30px;">
        <h2>Ph√¢n b·ªï m√¥n h·ªçc (t√≠nh theo gi·ªù)</h2>
        <canvas id="subjectChart"></canvas>
    </div>
    
    <div style="max-width: 350px; margin-bottom: 30px;">
        <h2>Th·ªëng k√™ c·∫£m x√∫c</h2>
        <canvas id="emotionChart"></canvas>
    </div>

    <div style="max-width: 350px; margin-bottom: 30px;">
        <h2>T·ª∑ l·ªá c√¥ng vi·ªác</h2>
        <canvas id="taskChart"></canvas>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // 2.1. L·∫•y d·ªØ li·ªáu JSON t·ª´ context Django
    const studyData = {{ study_data_json|safe }};
    const subjectData = {{ subject_data_json|safe }};
    const emotionData = {{ emotion_data_json|safe }};
    const taskData = {{ task_data_json|safe }};

    // 2.2. Bi·ªÉu ƒë·ªì 1: Th·ªùi gian h·ªçc (Bar Chart)
    const ctxStudy = document.getElementById('studyChart').getContext('2d');
    new Chart(ctxStudy, {
        type: 'bar',
        data: {
            labels: studyData.labels,
            datasets: [{
                label: 'S·ªë ph√∫t ƒë√£ h·ªçc',
                data: studyData.data,
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
            }]
        },
        options: { scales: { y: { beginAtZero: true } } }
    });

    // 2.3. Bi·ªÉu ƒë·ªì 2: M√¥n h·ªçc (Pie Chart)
    const ctxSubject = document.getElementById('subjectChart').getContext('2d');
    new Chart(ctxSubject, {
        type: 'pie',
        data: {
            labels: subjectData.labels,
            datasets: [{
                data: subjectData.data,
                // D√πng m√†u s·∫Øc t·ª´ database c·ªßa b·∫°n!
                backgroundColor: subjectData.colors, 
            }]
        }
    });

    // 2.4. Bi·ªÉu ƒë·ªì 3: C·∫£m x√∫c (Doughnut Chart)
    const ctxEmotion = document.getElementById('emotionChart').getContext('2d');
    new Chart(ctxEmotion, {
        type: 'doughnut',
        data: {
            labels: emotionData.labels, // Nh√£n ƒë√£ c√≥ icon (v√≠ d·ª•: 'üòä Happy')
            datasets: [{
                data: emotionData.data,
                backgroundColor: [ // Th√™m m√†u m·∫∑c ƒë·ªãnh
                    'rgba(75, 192, 192, 0.7)',
                    'rgba(255, 206, 86, 0.7)',
                    'rgba(255, 99, 132, 0.7)',
                    'rgba(153, 102, 255, 0.7)',
                    'rgba(201, 203, 207, 0.7)'
                ],
            }]
        }
    });

    // 2.5. Bi·ªÉu ƒë·ªì 4: T·ª∑ l·ªá c√¥ng vi·ªác (Pie Chart)
    const ctxTask = document.getElementById('taskChart').getContext('2d');
    new Chart(ctxTask, {
        type: 'pie',
        data: {
            labels: taskData.labels, // ['Ho√†n th√†nh', 'Ch∆∞a ho√†n th√†nh']
            datasets: [{
                data: taskData.data,
                backgroundColor: [
                    'rgba(75, 192, 192, 0.7)', // M√†u xanh cho 'Ho√†n th√†nh'
                    'rgba(255, 99, 132, 0.7)'  // M√†u ƒë·ªè cho 'Ch∆∞a ho√†n th√†nh'
                ],
            }]
        }
    });
</script>

{% endblock %}